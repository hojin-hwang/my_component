<html>
    <head>
        <style>
            body{margin: 0; font-size: 20px;}
        </style>
        <script src='/js/component-abs.js?t1{@SKIN_UPDATE_DATE}'></script><!--Component ABS-->
        
    </head>
    <body>
        <name-card-list></name-card-list>
        
        <template id="name_card_list">
            <style>
                section.name-card-list{ 
                    margin-bottom:20px;
                    padding : 12px;
                }
              
            </style>    
            <section class="name-card-list">

            </section>
        </template>

        <template id="name_card">
            <style>
                slot[name=company_name]{font-weight:bold; font-size:18px;}
                section{ margin-bottom:20px;}
                .name-card{display: flex; flex-direction: column; border: 1px solid #8d8d8d; border-radius: 15px; min-width:360px;}
                .profile{display: flex; gap:10px; align-items: center; padding: 20px;}
                .profile_user-info{display: flex; flex-direction: column; align-items:flex-start; gap: 11px;}
                .profile-add{display: flex; flex-direction: column; align-items: flex-start; gap:10px; min-height: 80px;  border: 1px solid #8d8d8d; border-radius: 15px; padding:20px; margin:20px; }
                .settings{display: flex; justify-content: space-between;width: 100%;}
            </style>    
            <section class="name-card">
                <article class="profile">
                    <slot name="user_image"></slot>
                    <div class="profile_user-info">
                        <div class="test" style="font-size: 40px;">
                            <slot name="name"></slot>
                        </div>
                        <slot name="email"></slot>
                    </div>
                </article>
                <article class="profile-add">
                    <slot name="company_name"></slot>
                    <slot name="phone"></slot>
                    <slot name="role"></slot>
                    <div class="settings">
                        <button type="button" class="command-modify-card">Change Card</button>
                        <button type="button" class="command-delete-card">Delete</button>
                    </div>                     
                </article>
            </section>
        </template>

        <div>Test Section</div>
        

        
        <script src='/js/name-card.js?t1{@SKIN_UPDATE_DATE}'></script><!--Component ABS-->
        <script>
            function post_message(message, data = null)
            {
                window.postMessage({msg:message, data:data}, location.origin);
            }  
            document.addEventListener('DOMContentLoaded', () => 
            {

                document.addEventListener('click', (e) => 
                {
                    e.composedPath().find((node) => 
                    {
                        if (!node.className || !node.className.match(/command/)) return false;

                        if (node.className.match(/ommand-set-editable/))
                        {
                            const name_card = document.querySelector('name-card');
                            name_card.setAttribute('editable', 'editable');
                            return;
                        }
                        if (node.className.match(/command-remvove-editable/))
                        {
                            const name_card = document.querySelector('name-card');
                            name_card.setAttribute('editable', 'nonEditable');
                            return;
                        }
                    });
                });
            });
        </script>

        <script>
        class NameCardList extends ComponentABS{
            constructor()
            {
                super();
                this._get_list();
            }
            static get observedAttributes() {return ['something']; }

            handleClick(e) {
                e.composedPath().find((node) => 
                {
                    if (!node.className || !node.className.match(/command/)) return false;
                    if (node.className.match(/command-modify-card/))
                    {
                        const randomColor = `#${Math.floor(Math.random()*16777215).toString(16)}`;
                        node.closest('section').style.color = randomColor;
                    }
                    if (node.className.match(/command-delete-card/))
                    {
                        post_message("done_delete_name_card", this.user_data);
                        this.remove();
                    }
                });
            }
            onMessage(event){
                const window_url = `https://${window.location.hostname}`;
                //if(event.origin !== window_url) return;
                if(event.data?.msg) 
                {
                    //data = event.data.data;
                    if(event.data.msg === `${this.message_prefix}_show_name_card`) 
                    {
                        this._render(event.data.data);
                    }

                }
            }

            connectedCallback() {
                //this._render(this.user_data);
            }
                
            disconnectedCallback(){
                console.log("disconnectedCallback");
                window.removeEventListener("message", this.receiveMessage);
            }
            
            attributeChangedCallback(name, oldValue, newValue) {
                console.log('Custom square element attributes changed.');
                console.log(`${name}, ${oldValue}, ${newValue},`);
            }

            getComponentProp(data_set_value)
            {
                const component_prop = {};
                
                switch(data_set_value.exam_type)
                {
                    default : console.log(data_set_value);
                }
                return component_prop;
            }

            _render(list = null)
            {
                const shadowRoot = this.attachShadow({mode: 'open'});
                const template = document.querySelector('#name_card_list');
                shadowRoot.appendChild(template.content.cloneNode(true));

                try
                {
                    list.forEach(element => {
                        const name_card = new NameCard(element);                
                        shadowRoot.querySelector('.name-card-list').appendChild(name_card);
                    });
                }
                catch(e)
                {
                    console.log(e);
                }
            }

            _get_list()
            {
                const card_list = [{name:"Tom Hank..", email:"Tom@naver.com", company_name:"Face Look Company.", profile_img:"https://studygym.master.to/upload/1584006494_login-top.jpg",phone:"+82-1111-5458",role:"Web Producer" }, {name:"John F kene..", email:"Smith@samsmith.com", company_name:"ABCD Company.", profile_img:"https://studygym.master.to/upload/1588814266_06.jpg",phone:"+82-2124-5458",role:"Web Designer" }]
                post_message(`${this.message_prefix}_show_name_card`, card_list);
                return false;
            }
        }
        customElements.define('name-card-list', NameCardList);

        </script>

        
    </body>
</html>